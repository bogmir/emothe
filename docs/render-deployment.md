# Deploying EMOTHE on Render

This project can be deployed with Render Blueprint using [render.yaml](../render.yaml).

## What is already configured

- Docker runtime build using the existing `Dockerfile`
- Managed PostgreSQL database (`emothe-db`)
- App service (`emothe-web`)
- Runtime env vars:
  - `DATABASE_URL` from the managed database
  - `SECRET_KEY_BASE` generated by Render
  - `PHX_SERVER=true`
  - `MIX_ENV=prod`
  - `POOL_SIZE=10`
- Pre-deploy migration command:
  - `/app/bin/emothe eval Emothe.Release.migrate`

The app now also supports Render host autodetection via `RENDER_EXTERNAL_HOSTNAME` when `PHX_HOST` is not explicitly set.

## One-click deployment (Dashboard)

1. Push this repository (including `render.yaml`) to GitHub.
2. In Render, click **New +** â†’ **Blueprint**.
3. Connect your GitHub repo and select this project.
4. Confirm creation of:
   - PostgreSQL service `emothe-db`
   - Web service `emothe-web`
5. Wait for first deploy to finish.

## Free tier notes

- `render.yaml` is configured with `plan: free` for both web and Postgres.
- Free web services spin down after inactivity and may take ~1 minute to wake.
- Free Postgres expires after 30 days unless upgraded.

## Render CLI setup (optional)

Install CLI (Linux x86_64):

```bash
mkdir -p "$HOME/.local/bin" "$HOME/.tmp/render-cli"
latest_tag=$(curl -fsSL https://api.github.com/repos/render-oss/cli/releases/latest | python3 -c 'import json,sys; print(json.load(sys.stdin)["tag_name"])')
version=${latest_tag#v}
curl -fL "https://github.com/render-oss/cli/releases/download/${latest_tag}/cli_${version}_linux_amd64.zip" -o "$HOME/.tmp/render-cli/render.zip"
unzip -o "$HOME/.tmp/render-cli/render.zip" -d "$HOME/.tmp/render-cli"
mv "$HOME/.tmp/render-cli/cli_${latest_tag}" "$HOME/.local/bin/render"
chmod +x "$HOME/.local/bin/render"
render --version
```

First-time auth:

```bash
render login
render workspace set
```

Validate blueprint via CLI:

```bash
render blueprints validate render.yaml
```

## Manual checks after deploy

- Open the web service URL and verify the home page loads.
- Confirm the migration step completed in deploy logs.
- If needed, set `PHX_HOST` explicitly in service env vars to your final Render domain.

## Optional production hardening

- Increase database plan/resources if needed.
- Configure `OTEL_TRACES_EXPORTER=otlp` and OTLP endpoint env vars if enabling tracing.
- Set up custom domain and TLS in Render dashboard.
